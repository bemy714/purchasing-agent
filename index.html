<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ‚æ¥µç‰ˆ æ¸¯å¹£â‡„å°å¹£ æ›ç®—å·¥å…· | æœˆå½±ä»£è³¼</title>
    <style>
        /* CSS æ¨£å¼èˆ‡ä¹‹å‰ç›¸åŒï¼Œæ­¤è™•ç‚ºæ±‚ç°¡æ½”çœç•¥ï¼Œè«‹æ²¿ç”¨æ‚¨ç¾æœ‰çš„ CSS */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        :root { --primary-color: #007bff; --secondary-color: #6c757d; --success-color: #28a745; --danger-color: #dc3545; --light-color: #f8f9fa; --dark-color: #343a40; --bg-color: #f4f7f9; --card-bg: #ffffff; --border-color: #e9ecef; --text-color: #212529; --text-muted: #6c757d; --shadow-color: rgba(0, 0, 0, 0.05); }
        html[data-theme='dark'] { --primary-color: #3694ff; --bg-color: #121212; --card-bg: #1e1e1e; --border-color: #3a3a3a; --text-color: #e0e0e0; --text-muted: #888888; --light-color: #2c2c2c; --dark-color: #f0f0f0; --shadow-color: rgba(0, 0, 0, 0.2); }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; transition: background-color 0.3s, color 0.3s; }
        .container { width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 25px; }
        .card { background-color: var(--card-bg); border-radius: 16px; box-shadow: 0 6px 25px var(--shadow-color); padding: 25px; transition: background-color 0.3s, box-shadow 0.3s; }
        .header { display: flex; justify-content: space-between; align-items: center; }
        .header-content { text-align: left; }
        .header-content h1 { margin: 0 0 5px 0; font-size: 1.8rem; color: var(--dark-color); }
        .header-content p { margin: 0; color: var(--text-muted); font-size: 0.95rem; }
        #dark-mode-toggle { background-color: var(--light-color); border: 1px solid var(--border-color); border-radius: 50%; width: 44px; height: 44px; cursor: pointer; font-size: 1.5rem; display: flex; justify-content: center; align-items: center; transition: all 0.3s ease; }
        #dark-mode-toggle:hover { background-color: var(--border-color); }
        .converter-wrapper { display: flex; align-items: center; justify-content: space-between; gap: 15px; }
        .currency-input { flex: 1; }
        .currency-input label { font-weight: 700; font-size: 0.9rem; margin-bottom: 8px; display: block; color: var(--dark-color); }
        .currency-input .input-group { display: flex; }
        .currency-input .input-group span { padding: 12px; background-color: var(--light-color); border: 1px solid var(--border-color); border-right: none; border-radius: 8px 0 0 8px; font-weight: 700; }
        .currency-input input { width: 100%; padding: 12px; font-size: 1.1rem; border: 1px solid var(--border-color); border-radius: 0 8px 8px 0; background-color: var(--card-bg); color: var(--text-color); }
        .currency-input input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15); }
        #swap-btn { background: none; border: 2px solid var(--border-color); border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; margin-top: 28px; color: var(--secondary-color); transition: all 0.3s ease; }
        #swap-btn:hover { background-color: var(--primary-color); color: white; border-color: var(--primary-color); transform: rotate(180deg); }
        .rate-section label { display: block; font-weight: 700; font-size: 0.9rem; margin-bottom: 8px; }
        .rate-info { display: flex; justify-content: space-between; align-items: center; background-color: var(--light-color); padding: 10px 15px; border-radius: 8px; border: 1px solid var(--border-color); }
        #rate-value { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
        #last-updated { font-size: 0.8rem; color: var(--text-muted); text-align: right; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary-color); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #result-card { background-color: var(--light-color); border: 1px solid var(--border-color); }
        #result-card.over-limit { border-color: var(--danger-color); background-color: rgba(220, 53, 69, 0.05); }
        #result-details { list-style: none; padding: 0; margin: 0; }
        #result-details li { display: flex; justify-content: space-between; padding: 12px 0; font-size: 0.95rem; border-bottom: 1px dashed var(--border-color); }
        #result-details li:last-child { border-bottom: none; }
        #result-details li span:last-child { font-weight: 700; color: var(--dark-color); }
        #total-amount-line { padding-top: 15px; margin-top: 10px; border-top: 2px solid var(--border-color); font-size: 1.1rem; font-weight: 700; }
        #total-amount-line span:first-child { color: var(--primary-color); }
        #total-amount { font-size: 2rem; color: var(--primary-color); }
        #alert-msg { color: var(--danger-color); font-weight: 700; text-align: center; padding: 10px; background-color: rgba(220, 53, 69, 0.1); border-radius: 8px; margin-top: 15px; font-size: 0.9rem; line-height: 1.5; }
        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .btn { padding: 12px; font-size: 1rem; font-weight: 700; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; width: 100%; }
        .btn:active { transform: scale(0.97); }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { filter: brightness(1.1); }
        .btn-secondary { background-color: var(--light-color); color: var(--dark-color); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background-color: var(--border-color); }
        .btn-secondary.copied { background-color: var(--success-color); color: white; }
        .faq-item { border-bottom: 1px solid var(--border-color); }
        .faq-item:last-child { border-bottom: none; }
        .faq-question { width: 100%; background: none; border: none; text-align: left; padding: 15px 0; font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .faq-question::after { content: '+'; font-size: 1.5rem; transition: transform 0.2s ease; }
        .faq-item.active .faq-question::after { transform: rotate(45deg); }
        .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; color: var(--text-muted); padding: 0 10px; line-height: 1.6; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: var(--card-bg); padding: 30px; border-radius: 16px; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal-content h2 { margin-top: 0; color: var(--dark-color); }
        .modal-details { margin: 20px 0; text-align: left; background: var(--light-color); padding: 15px; border-radius: 8px; }
        .modal-details p { margin: 10px 0; display: flex; justify-content: space-between; }
        .modal-details strong { color: var(--primary-color); font-size: 1.2rem; }
        .modal-copy-notice { font-size: 0.85rem; color: var(--text-muted); margin-top: 15px; }
        .modal-buttons { display: flex; gap: 15px; margin-top: 25px; }
        .footer { text-align: center; font-size: 0.85rem; color: var(--text-muted); }
        .footer a { color: var(--primary-color); text-decoration: none; font-weight: 700; }
        [style*="display: none"] { display: none !important; }
        @media (max-width: 600px) { body { padding: 10px; align-items: flex-start; } .container { gap: 20px; } .card { padding: 20px; } .header-content h1 { font-size: 1.6rem; } .converter-wrapper { flex-direction: column; gap: 10px; } #swap-btn { transform: rotate(90deg); margin-top: 0; } #swap-btn:hover { transform: rotate(270deg); } }
    </style>
</head>
<body>
    <!-- HTML çµæ§‹èˆ‡ä¹‹å‰ç›¸åŒ -->
    <div class="container">
        <div class="card"><div class="header"><div class="header-content"><h1>æ¸¯å¹£ â‡„ å°å¹£ æ›ç®—</h1><p>ç”± <a href="#" onclick="return false;">æœˆå½±ä»£è³¼</a> æä¾›</p></div><button id="dark-mode-toggle" title="åˆ‡æ›æ¨¡å¼">ğŸŒ™</button></div></div>
        <div class="card"><div class="converter-wrapper"><div class="currency-input" id="hkd-input-section"><label for="hkd-amount">æ‚¨æƒ³å…Œæ›çš„æ¸¯å¹£é‡‘é¡ (HKD)</label><div class="input-group"><span>HK$</span><input type="text" id="hkd-amount" inputmode="decimal"></div></div><button id="swap-btn" title="åˆ‡æ›å¹£åˆ¥">â‡„</button><div class="currency-input" id="twd-input-section"><label for="twd-amount">æ‚¨æƒ³æ”¯ä»˜çš„å°å¹£é‡‘é¡ (TWD)</label><div class="input-group"><span>NT$</span><input type="text" id="twd-amount" inputmode="decimal"></div></div></div><div class="rate-section" style="margin-top:20px"><label>æ‚¨çš„å ±åƒ¹åŒ¯ç‡ (HKDâ†’TWD)</label><div class="rate-info"><span id="rate-value"></span><div id="spinner-container"></div><span id="last-updated"></span></div></div></div>
        <div class="card" id="result-card" style="display: none;"><ul id="result-details"><li id="base-amount-li"><span>å…Œæ›é‡‘é¡</span><span id="base-amount">NT$ 0</span></li><li id="fee-li"><span>æœå‹™æ‰‹çºŒè²»</span><span id="fee-amount">NT$ 0</span></li><li id="tax-li"><span>é ä¼°ç‡Ÿæ¥­ç¨… (1%)</span><span id="tax-amount">NT$ 0</span></li></ul><div id="total-amount-line"><span>ç¸½æ‡‰ç¹³é‡‘é¡</span><span id="total-amount">NT$ 0</span></div><div id="alert-msg" style="display: none;"></div><div class="action-buttons"><button class="btn btn-secondary" id="copy-btn">è¤‡è£½ç¸½é‡‘é¡</button><button class="btn btn-secondary" id="clear-btn">æ¸…ç©º</button><a href="https://p.ecpay.com.tw/B061283" id="payment-link" target="_blank" rel="noopener noreferrer" style="text-decoration: none; grid-column: 1 / -1;"><button class="btn btn-primary" id="payment-btn">å‰å¾€ä»£è³¼ä»˜æ¬¾é é¢</button></a></div></div>
        <div class="card"><h2>å¸¸è¦‹å•é¡Œ (FAQ)</h2><div class="faq-item"><button class="faq-question">æ”¯æ´å“ªäº›ä»˜æ¬¾æ–¹å¼ï¼Ÿ</button><div class="faq-answer"><p>æˆ‘å€‘ç›®å‰æ”¯æ´è¶…å•†ä»£ç¢¼ç¹³è²»ï¼ˆå–®ç­† 6000 å…ƒä»¥ä¸‹ï¼‰èˆ‡éŠ€è¡Œè½‰å¸³ã€‚è‹¥é‡‘é¡è¶…é 6000 å…ƒï¼Œç³»çµ±æœƒå¼•å°æ‚¨ä½¿ç”¨éŠ€è¡Œè½‰å¸³æˆ–è¯ç¹«å®¢æœè™•ç†ã€‚</p></div></div><div class="faq-item"><button class="faq-question">ç‚ºä»€éº¼åŒ¯ç‡è·ŸéŠ€è¡Œä¸ä¸€æ¨£ï¼Ÿ</button><div class="faq-answer"><p>æˆ‘å€‘çš„å ±åƒ¹åŒ¯ç‡æ˜¯åŸºæ–¼åœ‹éš›å³æ™‚åŒ¯ç‡ï¼Œä¸¦åŠ ä¸Šæˆ‘å€‘çš„æœå‹™åŒ¯å·®èˆ‡ç‡Ÿé‹æˆæœ¬å¾Œæ‰€è¨­å®šçš„æœ€çµ‚åƒ¹æ ¼ã€‚</p></div></div></div>
        <div class="footer"><p>å¦‚æœ‰ç–‘å•ï¼Œæ­¡è¿è¯ç¹« DC: yueying0714</p></div>
    </div>
    <div class="modal-overlay" id="confirmation-modal"><div class="modal-content"><h2>è«‹ç¢ºèªä»˜æ¬¾è³‡è¨Š</h2><div class="modal-details"><p><span>æ‚¨å°‡æ”¯ä»˜ (å°å¹£)ï¼š</span> <strong id="modal-twd"></strong></p><p><span>æ‚¨å°‡æ”¶åˆ° (æ¸¯å¹£)ï¼š</span> <strong id="modal-hkd"></strong></p></div><p class="modal-copy-notice">é»æ“Šç¢ºèªå¾Œï¼Œç¸½é‡‘é¡å°‡è‡ªå‹•è¤‡è£½åˆ°æ‚¨çš„å‰ªè²¼ç°¿ã€‚</p><div class="modal-buttons"><button class="btn btn-secondary" id="cancel-payment-btn">å–æ¶ˆ</button><button class="btn btn-primary" id="confirm-payment-btn">ç¢ºèªä»˜æ¬¾</button></div></div></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- é…ç½®èˆ‡ DOM å…ƒç´  ---
    const CONFIG = {
        backendBaseUrl: '/api', // ä½¿ç”¨ç›¸å°è·¯å¾‘ï¼Œç¢ºä¿èƒ½æ­£ç¢ºæ‰¾åˆ°å¾Œç«¯
        paymentUrl: 'https://p.ecpay.com.tw/B061283',
        limit: 6000
    };
    const DOMElements = {
        // ... (èˆ‡ä¹‹å‰ç›¸åŒ)
        hkdAmountInput: document.getElementById('hkd-amount'),
        twdAmountInput: document.getElementById('twd-amount'),
        swapBtn: document.getElementById('swap-btn'),
        resultCard: document.getElementById('result-card'),
        baseAmountEl: document.getElementById('base-amount'),
        feeAmountEl: document.getElementById('fee-amount'),
        taxAmountEl: document.getElementById('tax-amount'),
        totalAmountEl: document.getElementById('total-amount'),
        alertMsg: document.getElementById('alert-msg'),
        paymentBtn: document.getElementById('payment-btn'),
        copyBtn: document.getElementById('copy-btn'),
        clearBtn: document.getElementById('clear-btn'),
        rateValueEl: document.getElementById('rate-value'),
        spinnerContainer: document.getElementById('spinner-container'),
        lastUpdatedEl: document.getElementById('last-updated'),
        darkModeToggle: document.getElementById('dark-mode-toggle'),
        confirmationModal: document.getElementById('confirmation-modal'),
        modalTwdEl: document.getElementById('modal-twd'),
        modalHkdEl: document.getElementById('modal-hkd'),
        confirmPaymentBtn: document.getElementById('confirm-payment-btn'),
        cancelPaymentBtn: document.getElementById('cancel-payment-btn'),
    };
    let state = { isHkdToTwd: true, lastCalculatedHkd: 0, lastCalculatedTwd: 0, isCalculating: false };

    // --- è¼”åŠ©å‡½å¼ (èˆ‡ä¹‹å‰ç›¸åŒ) ---
    const formatDateTime = dateStr => { const d = new Date(dateStr); return `${d.getFullYear()}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getDate()).padStart(2, '0')} ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}:${String(d.getSeconds()).padStart(2, '0')}`; };
    const formatNumberWithCommas = numStr => String(numStr).replace(/,/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    const parseFormattedNumber = numStr => parseFloat(String(numStr).replace(/,/g, '')) || 0;
    const animateCounter = (element, start, end, duration = 500) => { let startTime = null; const step = timestamp => { if (!startTime) startTime = timestamp; const progress = Math.min((timestamp - startTime) / duration, 1); element.textContent = `NT$ ${Math.floor(progress * (end - start) + start).toLocaleString()}`; if (progress < 1) window.requestAnimationFrame(step); }; window.requestAnimationFrame(step); };
    const copyToClipboard = (text, buttonElement) => { navigator.clipboard.writeText(text).then(() => { const originalHTML = buttonElement.innerHTML; buttonElement.innerHTML = '&#10003; å·²è¤‡è£½'; buttonElement.classList.add('copied'); setTimeout(() => { buttonElement.innerHTML = originalHTML; buttonElement.classList.remove('copied'); }, 1500); }).catch(err => console.error('è¤‡è£½å¤±æ•—: ', err)); };

    // --- æ ¸å¿ƒè«‹æ±‚å‡½å¼ ---
    const fetchCalculationResult = async (amount, direction) => {
        if (state.isCalculating) return null;
        state.isCalculating = true;
        DOMElements.spinnerContainer.innerHTML = '<div class="spinner"></div>';
        try {
            const response = await fetch(`${CONFIG.backendBaseUrl}/calculate`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ amount, direction }) });
            if (!response.ok) throw new Error('å¾Œç«¯ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤');
            return await response.json();
        } finally {
            state.isCalculating = false;
            DOMElements.spinnerContainer.innerHTML = '';
        }
    };
    
    const fetchInitialRate = async () => {
        DOMElements.spinnerContainer.innerHTML = '<div class="spinner"></div>';
        try {
            const response = await fetch(`${CONFIG.backendBaseUrl}/rate`);
            if (!response.ok) throw new Error('å¾Œç«¯ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤');
            const result = await response.json();
            DOMElements.rateValueEl.textContent = result.quoteRate.toFixed(4);
            DOMElements.lastUpdatedEl.innerHTML = `APIå³æ™‚: ${result.apiRate.toFixed(4)}<br>æ›´æ–°æ–¼: ${formatDateTime(result.lastUpdated)}`;
        } catch (error) {
            console.error('ç²å–åˆå§‹åŒ¯ç‡å¤±æ•—:', error);
            DOMElements.rateValueEl.textContent = 'éŒ¯èª¤';
            DOMElements.lastUpdatedEl.textContent = '(ç„¡æ³•é€£æ¥å¾Œç«¯)';
        } finally {
            DOMElements.spinnerContainer.innerHTML = '';
        }
    };
    
    const calculate = async () => {
        const amount = state.isHkdToTwd ? parseFormattedNumber(DOMElements.hkdAmountInput.value) : parseFormattedNumber(DOMElements.twdAmountInput.value);
        if (amount <= 0) { hideResult(); return; }
        const result = await fetchCalculationResult(amount, state.isHkdToTwd ? 'hkdToTwd' : 'twdToHkd');
        if (result) updateUIWithResult(result);
    };

    // --- UI æ›´æ–° (èˆ‡ä¹‹å‰ç›¸åŒ) ---
    const updateUIWithResult = (result) => {
        const { finalTwd, finalHkd, baseTwd, fee, tax, quoteRate, apiRate, lastUpdated } = result;
        DOMElements.rateValueEl.textContent = quoteRate.toFixed(4);
        DOMElements.lastUpdatedEl.innerHTML = `APIå³æ™‚: ${apiRate.toFixed(4)}<br>æ›´æ–°æ–¼: ${formatDateTime(lastUpdated)}`;
        if (state.isHkdToTwd) DOMElements.twdAmountInput.value = formatNumberWithCommas(finalTwd); else DOMElements.hkdAmountInput.value = formatNumberWithCommas(finalHkd);
        state.lastCalculatedTwd = finalTwd; state.lastCalculatedHkd = finalHkd;
        DOMElements.baseAmountEl.textContent = `NT$ ${baseTwd.toLocaleString()}`;
        DOMElements.feeAmountEl.textContent = `NT$ ${fee.toLocaleString()}`;
        DOMElements.taxAmountEl.textContent = `NT$ ${tax.toLocaleString()}`;
        const currentTotal = parseFormattedNumber(DOMElements.totalAmountEl.textContent.replace('NT$ ', ''));
        animateCounter(DOMElements.totalAmountEl, currentTotal, finalTwd);
        if (finalTwd > CONFIG.limit) {
            DOMElements.resultCard.classList.add('over-limit');
            DOMElements.alertMsg.innerHTML = 'âš ï¸ é‡‘é¡è¶…é 6000 å…ƒï¼Œè¶…å•†ç„¡æ³•ä»˜æ¬¾ã€‚<br>è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œä¸¦æ–¼ä»˜æ¬¾é é¢é¸æ“‡ã€éŠ€è¡Œè½‰å¸³ã€‘ã€‚';
            DOMElements.alertMsg.style.display = 'block';
            DOMElements.paymentBtn.textContent = 'å‰å¾€ä»˜æ¬¾ (è«‹ä½¿ç”¨éŠ€è¡Œè½‰å¸³)';
        } else {
            DOMElements.resultCard.classList.remove('over-limit');
            DOMElements.alertMsg.style.display = 'none';
            DOMElements.paymentBtn.textContent = 'å‰å¾€ä»£è³¼ä»˜æ¬¾é é¢';
        }
        DOMElements.resultCard.style.display = 'block';
    };
    const hideResult = () => { DOMElements.resultCard.style.display = 'none'; };
    const toggleDirection = () => {
        state.isHkdToTwd = !state.isHkdToTwd;
        DOMElements.hkdAmountInput.value = ''; DOMElements.twdAmountInput.value = ''; hideResult();
        const { hkdAmountInput, twdAmountInput } = DOMElements;
        const hkdSection = hkdAmountInput.parentElement.parentElement;
        const twdSection = twdAmountInput.parentElement.parentElement;
        if (state.isHkdToTwd) {
            hkdAmountInput.readOnly = false; twdAmountInput.readOnly = true;
            hkdSection.style.opacity = 1; twdSection.style.opacity = 0.5;
        } else {
            hkdAmountInput.readOnly = true; twdAmountInput.readOnly = false;
            hkdSection.style.opacity = 0.5; twdSection.style.opacity = 1;
        }
    };

    // --- äº‹ä»¶ç›£è½ (èˆ‡ä¹‹å‰ç›¸åŒ) ---
    [DOMElements.hkdAmountInput, DOMElements.twdAmountInput].forEach(input => {
        let debounceTimer;
        input.addEventListener('input', e => { const val = e.target.value.replace(/[^\d]/g, ''); e.target.value = formatNumberWithCommas(val); clearTimeout(debounceTimer); debounceTimer = setTimeout(calculate, 300); });
        input.addEventListener('focus', e => { if (e.target.id === 'hkd-amount' && !state.isHkdToTwd) toggleDirection(); if (e.target.id === 'twd-amount' && state.isHkdToTwd) toggleDirection(); });
    });
    DOMElements.swapBtn.addEventListener('click', toggleDirection);
    DOMElements.clearBtn.addEventListener('click', () => { DOMElements.hkdAmountInput.value = ''; DOMElements.twdAmountInput.value = ''; DOMElements.totalAmountEl.textContent = 'NT$ 0'; hideResult(); });
    DOMElements.copyBtn.addEventListener('click', e => { copyToClipboard(state.lastCalculatedTwd, e.currentTarget); });
    DOMElements.paymentBtn.addEventListener('click', () => { DOMElements.modalTwdEl.textContent = `NT$ ${state.lastCalculatedTwd.toLocaleString()}`; DOMElements.modalHkdEl.textContent = `HK$ ${state.lastCalculatedHkd.toLocaleString()}`; DOMElements.confirmationModal.style.display = 'flex'; });
    DOMElements.cancelPaymentBtn.addEventListener('click', () => { DOMElements.confirmationModal.style.display = 'none'; });
    DOMElements.confirmPaymentBtn.addEventListener('click', e => { copyToClipboard(state.lastCalculatedTwd, e.currentTarget); window.open(CONFIG.paymentUrl, '_blank'); setTimeout(() => { DOMElements.confirmationModal.style.display = 'none'; }, 500); });
    DOMElements.darkModeToggle.addEventListener('click', () => { const currentTheme = document.documentElement.getAttribute('data-theme'); const newTheme = currentTheme === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', newTheme); DOMElements.darkModeToggle.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'; localStorage.setItem('theme', newTheme); });
    document.querySelectorAll('.faq-question').forEach(button => { button.addEventListener('click', () => { const faqItem = button.parentElement; faqItem.classList.toggle('active'); const answer = faqItem.querySelector('.faq-answer'); answer.style.maxHeight = faqItem.classList.contains('active') ? answer.scrollHeight + "px" : 0; }); });

    // --- åˆå§‹åŒ– ---
    function initializeApp() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        DOMElements.darkModeToggle.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        toggleDirection();
        toggleDirection();
        fetchInitialRate();
    }
    initializeApp();
});
</script>
</body>
</html>
